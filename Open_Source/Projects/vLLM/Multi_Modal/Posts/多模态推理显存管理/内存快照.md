# 内存快照

```bash
export OOM_SNAPSHOT_ENABLE=1
export OOM_SNAPSHOT_PATH="/workspace/mem_snapshot/"
```

```python
import datetime
import torch_npu
from torch_npu.contrib import transfer_to_npu


torch_npu.npu.memory._record_memory_history(max_entries=100000)

# timestamp = datetime.now().strftime('%Y_%m_%d_%H_%M_%S')
# file_name = f"visual_mem_{timestamp}.pickle"
torch_npu.npu.memory._dump_snapshot("bench_vl.pickle")

torch_npu.npu.memory._record_memory_history(enabled=None)
```

```bash
# scp bench_vl.pickle shanshan-shen@103.151.173.98:/Users/shanshan-shen/Documents/Files/mem_snapshot/
scp -P 8333 root@139.9.155.20:/workspace/mem_snapshot/bench_vl.pickle /Users/shanshan-shen/Documents/Files/mem_snapshot/
```
